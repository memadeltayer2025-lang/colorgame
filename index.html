<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</title>

    <meta
      name="description"
      content="Ù„Ø¹Ø¨Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ù…ØªØ¹Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„ Ù„ØªØ·ÙˆÙŠØ± Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ‡Ø© Ø§Ù„Ø­Ø±ÙƒÙŠØ© ÙˆØ§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø¨ØµØ±ÙŠ"
    />
    <meta name="theme-color" content="#FF6B6B" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹Ø©" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹Ø©" />

    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIHJ4PSIzMiIgZmlsbD0iI0ZGNkI2QiIvPjxjaXJjbGUgY3g9Ijk2IiBjeT0iOTYiIHI9IjQ4IiBmaWxsPSJ3aGl0ZSIvPjx0ZXh0IHg9Ijk2IiB5PSIxMTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI0OCIgZmlsbD0iIzMzMyIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+MjTwvdGV4dD48L3N2Zz4="
    />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIHJ4PSI0MCIgZmlsbD0iI0ZGNkI2QiIvPjx0ZXh0IHg9IjkwIiB5PSIxMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI2MCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfjI08L3RleHQ+PC9zdmc+
"
    />

    <link rel="manifest" href="./manifest.json" />

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: 'Tajawal', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        overflow-x: hidden;
      }
      .game-container {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
        max-width: 500px;
        width: 100%;
        position: relative;
      }
      .game-title {
        font-size: 2.5rem;
        color: #ff6b6b;
        margin-bottom: 10px;
        font-weight: 700;
      }
      .game-subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 1.1rem;
      }
      .score-board {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 15px;
      }
      .score-item {
        text-align: center;
      }
      .score-label {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 5px;
      }
      .score-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
      }
      .game-area {
        min-height: 300px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
      }
      .color-circle {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        margin-bottom: 20px;
        border: 5px solid #fff;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .color-circle:hover {
        transform: scale(1.1);
      }
      .instruction {
        font-size: 1.3rem;
        color: #333;
        margin-bottom: 20px;
        font-weight: 700;
      }
      .color-buttons {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 20px;
      }
      .color-btn {
        padding: 15px 20px;
        border: none;
        border-radius: 15px;
        font-size: 1.1rem;
        font-weight: 700;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Tajawal', sans-serif;
      }
      .color-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }
      .start-btn {
        background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 25px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Tajawal', sans-serif;
      }
      .start-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(255, 107, 107, 0.4);
      }
      .timer-bar {
        width: 100%;
        height: 10px;
        background: #e0e0e0;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 20px;
      }
      .timer-fill {
        height: 100%;
        background: linear-gradient(45deg, #4caf50, #8bc34a);
        transition: width 0.1s linear;
        border-radius: 5px;
      }
      .game-over {
        text-align: center;
      }
      .final-score {
        font-size: 2rem;
        color: #ff6b6b;
        margin-bottom: 20px;
        font-weight: 700;
      }
      .celebration {
        font-size: 3rem;
        margin-bottom: 20px;
        animation: bounce 1s infinite;
      }
      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-20px);
        }
        60% {
          transform: translateY(-10px);
        }
      }
      .floating-score {
        position: absolute;
        font-size: 2rem;
        font-weight: 700;
        color: #4caf50;
        animation: floatUp 1s ease-out forwards;
        pointer-events: none;
      }
      @keyframes floatUp {
        0% {
          opacity: 1;
          transform: translateY(0);
        }
        100% {
          opacity: 0;
          transform: translateY(-50px);
        }
      }
      .wrong-answer {
        animation: shake 0.5s ease-in-out;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }
      @media (max-width: 480px) {
        .game-container {
          padding: 20px;
          margin: 10px;
        }
        .game-title {
          font-size: 2rem;
        }
        .color-circle {
          width: 120px;
          height: 120px;
        }
        .color-buttons {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1 class="game-title">ğŸŒˆ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h1>
      <p class="game-subtitle">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø£Ø³Ø±Ø¹ Ù…Ø§ ÙŠÙ…ÙƒÙ†!</p>
      <div class="score-board">
        <div class="score-item">
          <div class="score-label">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
          <div class="score-value" id="score">0</div>
        </div>
        <div class="score-item">
          <div class="score-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
          <div class="score-value" id="level">1</div>
        </div>
        <div class="score-item">
          <div class="score-label">Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©</div>
          <div class="score-value" id="bestScore">0</div>
        </div>
      </div>
      <div class="game-area" id="gameArea">
        <button class="start-btn" onclick="startGame()">
          ğŸ® Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨
        </button>
      </div>
    </div>
    <script>
      // Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('./sw.js')
            .then((registration) => {
              console.log('SW registered successfully');
            })
            .catch((error) => {
              console.log('SW registration failed');
            });
        });
      }

      // Game Variables: ØªØ¹Ø±ÙŠÙ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
      const gameState = {
        score: 0,
        level: 1,
        bestScore: localStorage.getItem('bestScore') || 0,
        isPlaying: false,
        currentTimer: null,
        currentColor: '',
        colors: [
          { name: 'Ø£Ø­Ù…Ø±', value: '#FF6B6B', arabic: 'Ø£Ø­Ù…Ø±' },
          { name: 'Ø£Ø²Ø±Ù‚', value: '#4ECDC4', arabic: 'Ø£Ø²Ø±Ù‚' },
          { name: 'Ø£Ø®Ø¶Ø±', value: '#45B7D1', arabic: 'Ø£Ø®Ø¶Ø±' },
          { name: 'Ø£ØµÙØ±', value: '#FFA726', arabic: 'Ø£ØµÙØ±' },
          { name: 'Ø¨Ù†ÙØ³Ø¬ÙŠ', value: '#AB47BC', arabic: 'Ø¨Ù†ÙØ³Ø¬ÙŠ' },
          { name: 'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ', value: '#FF7043', arabic: 'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ' },
        ],
      };

      // Initialize best score display
      document.getElementById('bestScore').textContent = gameState.bestScore;

      // startGame: ØªØ¨Ø¯Ø£ Ø¬ÙˆÙ„Ø© Ù„Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯Ø©
      function startGame() {
        gameState.score = 0;
        gameState.level = 1;
        gameState.isPlaying = true;
        updateScore();
        nextRound();
      }

      // nextRound: ØªÙ‡ÙŠØ¦ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©
      function nextRound() {
        if (!gameState.isPlaying) return;

        // Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        const randomIndex = Math.floor(Math.random() * gameState.colors.length);
        gameState.currentColor = gameState.colors[randomIndex];

        // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        const gameArea = document.getElementById('gameArea');
        gameArea.innerHTML = `
          <div class="timer-bar">
            <div class="timer-fill" id="timerFill" style="width: 100%"></div>
          </div>
          <div class="instruction">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰: ${gameState.currentColor.arabic}</div>
          <div class="color-circle" style="background-color: ${gameState.currentColor.value}"></div>
          <div class="color-buttons" id="colorButtons"></div>
        `;

        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
        const buttonsContainer = document.getElementById('colorButtons');
        const answerChoices = [gameState.currentColor];
        const otherColors = gameState.colors.filter(
          (color) => color.arabic !== gameState.currentColor.arabic
        );
        const shuffledOthers = otherColors.sort(() => Math.random() - 0.5);
        answerChoices.push(...shuffledOthers.slice(0, 3));
        const finalChoices = answerChoices.sort(() => Math.random() - 0.5);

        finalChoices.forEach((color) => {
          const button = document.createElement('button');
          button.className = 'color-btn';
          button.style.backgroundColor = color.value;
          button.textContent = color.arabic;
          button.onclick = () => checkAnswer(color.arabic);
          buttonsContainer.appendChild(button);
        });

        startTimer();
      }

      // startTimer: ØªØ¨Ø¯Ø£ Ù…Ø¤Ù‚Øª Ø§Ù„Ø¬ÙˆÙ„Ø©
      function startTimer() {
        // Ù…Ø³Ø­ Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„Ù‡
        if (gameState.currentTimer) {
          clearInterval(gameState.currentTimer);
        }

        const timerFill = document.getElementById('timerFill');
        const baseTime = Math.max(3000 - gameState.level * 200, 1500);
        const interval = 50;
        const totalSteps = baseTime / interval;
        let currentStep = 0;

        const timer = setInterval(() => {
          currentStep++;
          const percentage = ((totalSteps - currentStep) / totalSteps) * 100;
          timerFill.style.width = percentage + '%';
          
          if (currentStep >= totalSteps) {
            clearInterval(timer);
            if (gameState.isPlaying) {
              wrongAnswer();
            }
          }
        }, interval);
        gameState.currentTimer = timer;
      }

      // checkAnswer: ØªØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
      function checkAnswer(selectedColor) {
        if (!gameState.isPlaying) return;
        clearInterval(gameState.currentTimer);
        if (selectedColor === gameState.currentColor.arabic) {
          correctAnswer();
        } else {
          wrongAnswer();
        }
      }

      // correctAnswer: ØªØªÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
      function correctAnswer() {
        gameState.score += gameState.level * 10;
        showFloatingScore('+' + gameState.level * 10);
        if (gameState.score >= 50 && gameState.score % 50 === 0) {
            gameState.level++;
        }
        updateScore();
        setTimeout(() => {
          nextRound();
        }, 1000);
      }

      // wrongAnswer: ØªØªÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©
      function wrongAnswer() {
        const gameArea = document.getElementById('gameArea');
        gameArea.classList.add('wrong-answer');
        setTimeout(() => {
          gameArea.classList.remove('wrong-answer');
          endGame();
        }, 500);
      }

      // endGame: ØªÙ†Ù‡ÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªØ¸Ù‡Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      function endGame() {
        gameState.isPlaying = false;
        clearInterval(gameState.currentTimer);
        if (gameState.score > gameState.bestScore) {
          gameState.bestScore = gameState.score;
          localStorage.setItem('bestScore', gameState.bestScore);
          document.getElementById('bestScore').textContent = gameState.bestScore;
        }

        const gameArea = document.getElementById('gameArea');
        gameArea.innerHTML = `
          <div class="game-over">
            <div class="celebration">${
              gameState.score > 50 ? 'ğŸ‰' : 'ğŸ˜Š'
            }</div>
            <div class="final-score">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${gameState.score}</div>
            <p style="margin-bottom: 20px; color: #666;">
              ${
                gameState.score > gameState.bestScore
                  ? 'Ø±Ù‚Ù… Ù‚ÙŠØ§Ø³ÙŠ Ø¬Ø¯ÙŠØ¯! ğŸ†'
                  : 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªØ­Ø³ÙŠÙ† Ù†ØªÙŠØ¬ØªÙƒ!'
              }
            </p>
            <button class="start-btn" onclick="startGame()">ğŸ”„ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
          </div>
        `;
      }

      // updateScore: ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰
      function updateScore() {
        document.getElementById('score').textContent = gameState.score;
        document.getElementById('level').textContent = gameState.level;
      }

      // showFloatingScore: Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
      function showFloatingScore(text) {
        const gameArea = document.getElementById('gameArea');
        const floatingScore = document.createElement('div');
        floatingScore.className = 'floating-score';
        floatingScore.textContent = text;
        floatingScore.style.left = '50%';
        floatingScore.style.top = '50%';
        floatingScore.style.transform = 'translateX(-50%)';
        gameArea.appendChild(floatingScore);
        setTimeout(() => {
          if (floatingScore.parentNode) {
            floatingScore.parentNode.removeChild(floatingScore);
          }
        }, 1000);
      }

      // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø¨Ø§Ù„ØªØ£Ø´ÙŠØ± Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„
      let lastTouchEnd = 0;
      document.addEventListener(
        'touchend',
        function (event) {
          const now = new Date().getTime();
          if (now - lastTouchEnd <= 300) {
            event.preventDefault();
          }
          lastTouchEnd = now;
        },
        false
      );

      // Install prompt for PWA
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
      });
    </script>
  </body>
</html>
